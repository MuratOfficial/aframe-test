<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Компонент изменения цвета</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <style>
    a-scene { height: 400px; }
    .info { margin: 20px 0; }
  </style>
</head>
<body>
  <h1>Компонент изменения цвета</h1>
  <div class="info">
    <p>Наведите курсор на куб и нажмите, чтобы увидеть изменение цвета</p>
  </div>
  
  <a-scene>
    <!-- Камера с курсором -->
    <a-camera>
      <a-cursor geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: black; shader: flat"
                animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
                animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"></a-cursor>
    </a-camera>
    
    <a-box position="0 1.6 -3" 
           rotation="0 45 0" 
           color="#4CC3D9" 
           color-changer="color: #EF2D5E; event: click; duration: 1000"
           animation__mouseenter="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 300"
           animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 300"></a-box>
           
    <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
    <a-sky color="#ECECEC"></a-sky>
  </a-scene>

  <script>
    AFRAME.registerComponent('color-changer', {
      schema: {
        color: {type: 'color', default: '#FF0000'},
        event: {type: 'string', default: 'click'},
        duration: {type: 'number', default: 500}
      },

      init: function() {
        console.log('Color changer component initialized for event:', this.data.event);
        
        // Сохраняем оригинальный цвет
        this.originalColor = this.el.getAttribute('color');
        console.log('Original color saved:', this.originalColor);
        
        // Привязываем контекст и добавляем слушатель событий
        this.changeColor = this.changeColor.bind(this);
        
        // Ждем пока элемент будет готов
        this.el.addEventListener('loaded', () => {
          console.log('Element loaded, adding event listener');
          this.el.addEventListener(this.data.event, this.changeColor);
        });
        
        // Если элемент уже загружен
        if (this.el.hasLoaded) {
          this.el.addEventListener(this.data.event, this.changeColor);
        }
      },

      changeColor: function(event) {
        console.log('Color change triggered by event:', event.type);
        
        const el = this.el;
        const newColor = this.data.color;
        
        console.log('Changing color from', this.originalColor, 'to', newColor);
        
        // Изменяем цвет
        el.setAttribute('color', newColor);
        
        // Возвращаем оригинальный цвет через заданное время
        setTimeout(() => {
          el.setAttribute('color', this.originalColor);
          console.log('Color reverted to', this.originalColor);
        }, this.data.duration);
      },

      update: function() {
        // Обновляем оригинальный цвет если компонент обновлен
        this.originalColor = this.el.getAttribute('color');
      },

      remove: function() {
        console.log('Removing event listener');
        this.el.removeEventListener(this.data.event, this.changeColor);
      }
    });
  </script>
</body>
</html>